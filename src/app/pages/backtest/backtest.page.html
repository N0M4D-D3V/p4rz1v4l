<div class="row">
  <!-- FORM -->
  <div class="col-4" [formGroup]="form" *ngIf="form">
    <div class="row">
      <select class="form-select" formControlName="stratID">
        <option selected disabled [value]="null">Select strategy</option>
        <option *ngFor="let strat of strategies$ | async" [value]="strat.id">
          {{ strat.name }}
        </option>
      </select>
    </div>

    <div class="row mt-1">
      <select class="form-select col me-1" formControlName="exchange">
        <option selected disabled value="">Exchange</option>
        <option *ngFor="let exchange of exchangeList" value="{{ exchange }}">
          {{ exchange | titlecase }}
        </option>
      </select>
      <select class="form-select col ms-1" formControlName="market">
        <option selected disabled value="">Market</option>
        <option
          [value]="market?.key"
          *ngFor="let market of exchange?.markets | keyvalue"
          [value]="market?.key"
        >
          {{ market?.key }}
        </option>
      </select>
    </div>

    <div class="row mt-1">
      <select class="form-select col me-1" formControlName="timeframe">
        <option selected disabled value="">Timeframe</option>
        <option
          *ngFor="let timeframe of exchange?.timeframes | keyvalue"
          value="{{ timeframe.key }}"
        >
          {{ timeframe.value }}
        </option>
      </select>
      <select class="form-select col ms-1" formControlName="limit">
        <option selected disabled value="">Candles</option>
        <option value="100">100</option>
        <option value="500">500</option>
        <option value="1000">1000</option>
      </select>
    </div>

    <div class="row mt-1">
      <div class="input-group p-0">
        <div class="input-group-prepend">
          <label class="input-group-text">Fees %</label>
        </div>
        <input
          type="number"
          class="form-control"
          formControlName="feePercentage"
        />
      </div>
    </div>

    <hr />

    <div class="row">
      <div class="form-floating mb-3 col">
        <input
          type="number"
          class="form-control"
          id="balance"
          formControlName="balance"
        />
        <label for="balance">Balance</label>
      </div>

      <div class="form-floating col">
        <input
          type="number"
          class="form-control"
          id="leverage"
          formControlName="leverage"
        />
        <label for="leverage">Leverage</label>
      </div>
    </div>

    <div class="row">
      <div class="form-check form-switch ms-3">
        <input
          class="form-check-input"
          type="checkbox"
          id="flexSwitchCheckDefault"
          formControlName="stoploss"
        />
        <label class="form-check-label" for="flexSwitchCheckDefault"
          >Stoploss</label
        >
      </div>
    </div>

    <hr />

    <div class="row">
      <select class="form-select" formControlName="dataset">
        <option selected disabled [value]="null">Load Dataset</option>
        <option *ngFor="let set of datasets$ | async" [value]="set.id">
          From {{ set.from }} to {{ set.to }} ({{ set.exchange | titlecase
          }})({{ set.market }})({{ set.candles.length }}/{{ set.timeframe }})
        </option>
      </select>
    </div>

    <div class="row mt-1">
      <div class="input-group p-0">
        <div class="input-group-prepend">
          <label class="input-group-text">From</label>
        </div>
        <input type="date" class="form-control" formControlName="from" />
      </div>
    </div>

    <div class="row mt-1">
      <div class="input-group p-0">
        <div class="input-group-prepend">
          <label class="input-group-text">To</label>
        </div>
        <input type="date" class="form-control" formControlName="to" />
      </div>
    </div>

    <div class="row mt-3">
      <button
        class="btn btn-danger col-2 ms-1"
        (click)="onRemoveDataset()"
        [disabled]="!datasetControl.value"
      >
        <i class="bi bi-trash-fill"></i>
      </button>
      <button
        class="btn btn-success col ms-1"
        (click)="onSaveDataset()"
        [disabled]="!form.valid"
      >
        SAVE DATASET
        <i class="bi bi-sd-card-fill"></i>
      </button>
    </div>

    <hr />

    <div class="row mt-5">
      <button
        class="btn btn-primary col me-1"
        [disabled]="!form.valid"
        (click)="onTest()"
      >
        TEST
      </button>
      <button
        class="btn btn-success col ms-1"
        (click)="onEdit()"
        [disabled]="!isEditAvailable"
      >
        EDIT
      </button>
    </div>
  </div>

  <!-- RESULTS -->
  <div class="col-8 h-100">
    <app-backtest-result [results]="results"></app-backtest-result>
  </div>
</div>
