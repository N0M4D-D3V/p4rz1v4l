<div class="w-100 position-relative">
  <button class="btn btn-lg end-0 position-absolute" (click)="onDismiss()">
    <i class="bi bi-x-circle text-danger fw-bold"></i>
  </button>
</div>

<div class="ps-5 mt-2">
  <h1>Estrategy Editor</h1>
</div>

<div class="p-5" [formGroup]="form">
  <div class="row">
    <div class="col-6">
      <div class="input-group mb-3">
        <div class="input-group-prepend">
          <label class="input-group-text">Name</label>
        </div>
        <input
          type="text"
          class="form-control"
          placeholder="Strategy name"
          formControlName="name"
        />
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-6">
      <div class="input-group mb-3">
        <div class="input-group-prepend">
          <label class="input-group-text">Stoploss</label>
        </div>
        <input type="number" class="form-control" formControlName="stoploss" />
      </div>
    </div>
    <div class="col-6">
      <div class="input-group mb-3">
        <div class="input-group-prepend">
          <label class="input-group-text">Take Profit</label>
        </div>
        <input
          type="number"
          class="form-control"
          formControlName="takeprofit"
        />
      </div>
    </div>
  </div>

  <hr />
  <h2 class="text-center">Indicators</h2>

  <app-item
    *ngFor="let indicator of indicators; let index = index"
    [item]="indicator"
    (onDelete)="onDeleteIndicator(index)"
    (onEdit)="onEditIndicator($event, index, editPopover)"
  ></app-item>

  <div class="w-100 mt-3" (click)="editPopover.open()">
    <button
      class="btn btn-lg btn-primary w-100"
      [ngbPopover]="popContent"
      [autoClose]="false"
      triggers="manual"
      placement="bottom auto"
      #editPopover="ngbPopover"
    >
      <i class="bi bi-plus-circle-fill"></i>
    </button>
  </div>

  <hr />

  <div class="row mt-5">
    <button
      class="btn btn-danger col me-1"
      (click)="onDeleteStrategy()"
      [disabled]="!selectedStrategy?.data"
    >
      DELETE
    </button>
    <button
      class="btn btn-success col ms-1"
      (click)="onSaveStrategy()"
      [disabled]="!form.valid || !indicators"
    >
      SAVE
    </button>
  </div>
</div>

<ng-template #popContent>
  <app-indicator-popover
    [editableIndicator]="indicatorToEdit"
    (onClose)="editPopover.close()"
    (onDelete)="onDeleteIndicator($event.provisionalID - 1); editPopover.close()"
    (onSave)="onSaveIndicator($event, editPopover)"
  ></app-indicator-popover>
</ng-template>
